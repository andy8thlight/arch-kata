---
id: "0009"
title: Personalisation / Concierge Service Architecture
status: proposed
date: 2025-10-22
---

## Context and Problem Statement

MobilityCorp offers a **Concierge Service** that provides users with intelligent, context-aware recommendations —  
e.g. *“Pick up from Hub B, 5 minutes shorter in rain”*, *“Drop off at Hub C for bonus credit”*, or *“Avoid line 1, metro strike detected”*.  

Early prototypes used static rules or proximity lookups.  
As MobilityCorp expands across Europe, the Concierge must now:  

- Combine **real-time demand forecasts (ADR-004)** with **live transport and weather data**.  
- Respect **user tier, consent, and policy rules (ADR-019)**.  
- Provide **explainable**, **auditable**, and **GDPR-compliant** recommendations.  
- Deliver results through the **AI Interchange Layer (ADR-014)** for reuse by mobile and web apps.

---

## Questions

- How should the service blend prediction, weather, and policy data in real time?  
- Should recommendations be generated centrally or region-locally?  
- How are recommendations explained and logged for compliance?  
- How do we ensure fairness and avoid over-personalisation bias?  

---

## Options

### Option A — Rule-Based Engine
Hand-coded heuristics (e.g. distance + availability).

**Pros**
- Simple and transparent.  
**Cons**
- Ignores dynamic context and demand; poor scalability.  

---

### Option B — Central ML-Driven Service (Recommended)
A central **Concierge Service** that fuses **Demand Prediction**, **Weather**, and **Transport Status** features via the **Feature Store (ADR-016)**, applies policy and consent gates, and serves contextual recommendations through the **AI Interchange**.

**Pros**
- Context-rich, adaptive, region-aware.  
- Reuses common data foundation and governance.  
**Cons**
- Requires cross-service coordination and cost management.  

---

## Recommendation

Adopt **Option B – Context-Aware Concierge Service** integrated with the AI Interchange and Feature Store.

**Key design decisions**
1. **Inputs:**  
   - `demand.predictions` topic from ADR-004.  
   - `weather.conditions` and `transport.status` topics from ADR-007.  
   - User profile + policy rules from Policy-as-Data (ADR-019).  
2. **Processing:**  
   - Join features via Feature Store (ADR-016).  
   - Score hubs/routes for user context and demand weighting.  
   - Apply pricing, tier, and consent gates.  
3. **Outputs:**  
   - Personalised actions (e.g. *recommended hub*, *bonus offer*) published to `concierge.recommendations`.  
   - Explanations stored in Audit Log (ADR-011).  
4. **Governance & Explainability:**  
   - Each recommendation links to model version, features, and rationale.  
   - Visible in AI Governance Dashboard (ADR-017).  
5. **Integration:**  
   - Served through AI Interchange API for mobile/web.  
   - Observability and cost tracked via ADR-013 and ADR-018.

---

## Consequences

**Positive**
- Dynamic, user-specific experiences.  
- Improved demand balancing and satisfaction.  
- Full transparency and auditability.  

**Trade-offs**
- Requires coordination between ML, policy, and privacy domains.  
- Higher compute cost for contextual inference.  

---

## Implementation Details (High-level)

| Component | Responsibility | Notes |
|---|---|---|
| **AI Interchange (ADR-014)** | Entry point for requests | Enforces auth & consent |
| **Concierge Engine** | Merge demand, weather, transport, policy | Generates ranked recommendations |
| **Feature Store (ADR-016)** | Supplies contextual features | Cached by region & user tier |
| **Policy-as-Data (ADR-019)** | Provides pricing/fine & premium rules | Versioned and auditable |
| **Demand Prediction (ADR-004)** | Feeds expected hub demand | From Kafka topic |
| **Weather & Transport Feeds (ADR-007)** | Supply environmental context | Via event bus |
| **Audit Log (ADR-011)** | Record recommendations & rationale | Tamper-evident |
| **AI Governance (ADR-017)** | Host explainability endpoint | GDPR Art. 22 compliance |
| **Observability (ADR-013)** | Monitor latency & success rates | Unified OTel metrics |

**Sequence Example**

---

## Risks and Mitigations

| Risk                          | Likelihood | Impact | Mitigation                               |
| ----------------------------- | ---------: | -----: | ---------------------------------------- |
| Over-personalisation bias     |        Med |   High | Bias detection & fairness metrics        |
| API latency under load        |        Med |    Med | Caching & async responses                |
| Incomplete regional data      |        Med |    Med | Fallback heuristics per region           |
| GDPR non-compliance           |        Low |   High | Explicit consent gating & explainability |
| Cost from frequent inferences |        Med |    Med | Budget guardrails (ADR-018)              |

---

## Alternatives Considered

* Static rules – rejected for lack of contextual awareness.
* Client-side personalisation – rejected for privacy and data duplication.
* Central AI-driven engine – chosen for scalability and compliance.

## Links

* ADR-004 – Demand Prediction Model
* ADR-007 – Data Platform Architecture
* ADR-011 – Immutable Audit Log Architecture
* ADR-013 – Observability & Metrics Standardisation
* ADR-014 – AI Interchange Layer Architecture
* ADR-016 – AI Data Pipeline & Feature Store Design
* ADR-017 – AI Governance & Explainability Framework
* ADR-018 – AI Cost & Budget Guardrails
* ADR-019 – Policy-as-Data Framework