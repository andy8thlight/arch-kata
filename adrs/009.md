---
id: "0009"
title: Personalisation / Concierge Service Architecture
status: proposed
date: 2025-10-22
---

## Context and Problem Statement

MobilityCorp offers a **Concierge Service** that provides users with intelligent, context-aware recommendations —  
e.g. *“Pick up from Hub B, 5 minutes shorter in rain”*, *“Drop off at Hub C for bonus credit”*, or *“Avoid line 1, metro strike detected”*.  

Early prototypes used static rules or proximity lookups.  
As MobilityCorp expands across Europe, the Concierge must now:  

- Combine **real-time demand forecasts (ADR-004)** with **live transport and weather data**.  
- Respect **user tier, consent, and policy rules (ADR-019)**.  
- Provide **explainable**, **auditable**, and **GDPR-compliant** recommendations.  
- Deliver results through the **AI Interchange Layer (ADR-014)** for reuse by mobile and web apps.

---

## Questions

- How should the service blend prediction, weather, and policy data in real time?  
- Should recommendations be generated centrally or region-locally?  
- How are recommendations explained and logged for compliance?  
- How do we ensure fairness and avoid over-personalisation bias?  

---

## Options

### Option A — Rule-Based Engine
Hand-coded heuristics (e.g. distance + availability).

**Pros**
- Simple and transparent.  
**Cons**
- Ignores dynamic context and demand; poor scalability.  

---

### Option B — Central ML-Driven Service (Recommended)
A central **Concierge Service** that fuses **Demand Prediction**, **Weather**, and **Transport Status** features via the **Feature Store (ADR-016)**, applies policy and consent gates, and serves contextual recommendations through the **AI Interchange**.

**Pros**
- Context-rich, adaptive, region-aware.  
- Reuses common data foundation and governance.  
**Cons**
- Requires cross-service coordination and cost management.  

---


## Recommendation

Adopt **Option B – Context-Aware Concierge Service** integrated with the AI Interchange and Feature Store.

**Key design decisions**
1. **Inputs:**  
   - `demand.predictions` topic from ADR-004.  
   - `weather.conditions` and `transport.status` topics from ADR-007.  
   - User profile + policy rules from Policy-as-Data (ADR-019).  
2. **Processing:**  
   - Join features via Feature Store (ADR-016).  
   - Score hubs/routes for user context and demand weighting.  
   - Apply pricing, tier, and consent gates.  
3. **Outputs:**  
   - Personalised actions (e.g. *recommended hub*, *bonus offer*) published to `concierge.recommendations`.  
   - Explanations stored in Audit Log (ADR-011).  
4. **Governance & Explainability:**  
   - Each recommendation links to model version, features, and rationale.  
   - Visible in AI Governance Dashboard (ADR-017).  
5. **Integration:**  
   - Served through AI Interchange API for mobile/web.  
   - Observability and cost tracked via ADR-013 and ADR-018.

## Rationale

Option B (Central ML-Driven Service) is chosen for its ability to provide context-rich, adaptive, and region-aware recommendations, leveraging a unified data foundation and robust governance. This approach enables explainability, auditability, and compliance, which are essential for user trust and regulatory requirements. It also supports scalability and reuse across channels (mobile/web).

## Consequences

**Positive Consequences:**
- Dynamic, user-specific experiences and improved demand balancing.
- Full transparency, auditability, and GDPR compliance.
- Reuse of data foundation and governance across AI/ML services.

**Negative Consequences / Trade-offs:**
- Requires coordination between ML, policy, and privacy domains.
- Higher compute cost for contextual inference.
- Increased complexity in monitoring, fairness, and compliance.

## Implementation Details (High-level)

| Component | Responsibility | Notes |
|---|---|---|
| **AI Interchange (ADR-014)** | Entry point for requests | Enforces auth & consent |
| **Concierge Engine** | Merge demand, weather, transport, policy | Generates ranked recommendations |
| **Feature Store (ADR-016)** | Supplies contextual features | Cached by region & user tier |
| **Policy-as-Data (ADR-019)** | Provides pricing/fine & premium rules | Versioned and auditable |
| **Demand Prediction (ADR-004)** | Feeds expected hub demand | From Kafka topic |
| **Weather & Transport Feeds (ADR-007)** | Supply environmental context | Via event bus |
| **Audit Log (ADR-011)** | Record recommendations & rationale | Tamper-evident |
| **AI Governance (ADR-017)** | Host explainability endpoint | GDPR Art. 22 compliance |
| **Observability (ADR-013)** | Monitor latency & success rates | Unified OTel metrics |

**Sequence Example**

<img width="4816" height="1266" alt="009" src="https://github.com/user-attachments/assets/f3073c77-3e4a-4aa2-ab0c-c40886ac71fb" />

---

## Risks and Mitigations

| Risk                          | Likelihood | Impact | Mitigation                               |
| ----------------------------- | ---------: | -----: | ---------------------------------------- |
| Over-personalisation bias     |        Med |   High | Bias detection & fairness metrics        |
| API latency under load        |        Med |    Med | Caching & async responses                |
| Incomplete regional data      |        Med |    Med | Fallback heuristics per region           |
| GDPR non-compliance           |        Low |   High | Explicit consent gating & explainability |
| Cost from frequent inferences |        Med |    Med | Budget guardrails (ADR-018)              |

---

## Alternatives Considered

* Static rules – rejected for lack of contextual awareness.
* Client-side personalisation – rejected for privacy and data duplication.
* Central AI-driven engine – chosen for scalability and compliance.


---

## Rationale

Option B (Central ML-Driven Service) is chosen for its ability to provide context-rich, adaptive, and region-aware recommendations, leveraging a unified data foundation and robust governance. This approach enables explainability, auditability, and compliance, which are essential for user trust and regulatory requirements. It also supports scalability and reuse across channels (mobile/web).

## Consequences

**Positive Consequences:**
- Dynamic, user-specific experiences and improved demand balancing.
- Full transparency, auditability, and GDPR compliance.
- Reuse of data foundation and governance across AI/ML services.

**Negative Consequences / Trade-offs:**
- Requires coordination between ML, policy, and privacy domains.
- Higher compute cost for contextual inference.
- Increased complexity in monitoring, fairness, and compliance.

## Stakeholders

- Product Management: Defines requirements, prioritizes features, and coordinates rollout.
- AI/ML Engineering: Develops and maintains recommendation models and explainability logic.
- Data Engineering: Owns Feature Store, data pipelines, and integration.
- Compliance & Legal: Oversees auditability, data privacy, and regulatory adherence.
- Platform Engineering: Maintains AI Interchange and observability.

## Reliability, Audit & Compliance

- All recommendations and explanations must be logged to the Immutable Audit Log ([ADR-011](./011.md)).
- Consent and policy gates are enforced for every recommendation.
- Compliance team reviews audit logs quarterly and after any major incident.

## GDPR & Data Privacy

- All user data processed for recommendations must be minimized, encrypted, and handled per GDPR and user consent.
- Users must be able to request access, correction, or deletion of their recommendation history; all such actions are logged.
- Regular privacy impact assessments (PIAs) are conducted by Compliance & Legal.

## Incident Response & Escalation

- Critical failures (e.g., recommendation errors, consent violations, data leaks) must trigger automated alerts to AI/ML Engineering and Compliance.
- Incident response runbooks are maintained in the internal knowledge base.
- Major incidents require post-mortem review and communication to all stakeholders.
- Escalation: AI/ML Engineering → Data Engineering → Compliance/Legal → Executive Leadership.

## Schema Evolution Feedback Loop

- All feature and recommendation schema changes must be proposed via change request, reviewed by Data and AI/ML Engineering, and validated by QA before deployment.
- Breaking changes require migration plan, deprecation notice, and user communication.
- Feedback from users and downstream consumers must be solicited and documented for each schema change.

## Stakeholder Communication Plan

- Major changes, schema updates, and incident reports are communicated via project meetings, email, and internal documentation.
- Stakeholder roles and responsibilities are reviewed quarterly.
- Feedback channels (in-app, email, ticketing) are monitored by Product and Engineering.

## Risk Ownership & Audit

- Each risk in the Risks and Mitigations table is assigned an owner:
   - Over-personalisation bias: AI/ML Engineering
   - API latency: Platform Engineering
   - Incomplete regional data: Data Engineering
   - GDPR non-compliance: Compliance & Legal
   - Cost from frequent inferences: Product Management
- Risk register is reviewed quarterly or after major incidents.
- Audit logs are owned by Compliance, with technical implementation by Data and AI/ML Engineering.

## Technology Rationale

- **Central ML-Driven Service**: Enables context-rich, adaptive recommendations and explainability.
- **Feature Store**: Provides unified, versioned features for all models.
- **AI Interchange**: Standardizes access, consent, and observability.
- **Audit Log**: Ensures tamper-evident, auditable recommendations.
- **Policy-as-Data**: Supports versioned, explainable policy enforcement.

## Metrics & Observability

- Recommendation latency, success rate, fairness metrics, and cost are monitored via the Observability Platform ([ADR-013](./013.md)).
- Alerts are configured for high latency, fairness violations, and cost overruns.

## Follow-ups / Open Issues

- Finalize feature and recommendation schemas. **Owner:** Data & AI/ML Engineering. **Due:** 2025-11-10.
- Define SLAs for recommendation latency, reliability, and fairness. **Owner:** Product Management. **Due:** 2025-11-15.
- Review and update compliance documentation as regulations evolve. **Owner:** Compliance. **Ongoing.**
- Confirm stakeholder sign-off at each rollout milestone. **Owner:** Product Management. **Due:** Each milestone.
- Track open issues with regional data, fairness, and user feedback. **Owner:** AI/ML Engineering. **Ongoing.**
- Document and test incident response and escalation procedures. **Owner:** AI/ML Engineering. **Due:** 2025-11-20.

## References

- [GDPR Regulation (EU) 2016/679](https://gdpr.eu/)
- [Explainable AI (XAI) Principles](https://www.nist.gov/artificial-intelligence/explainable-ai)


## Related ADRs

- [ADR-004 – Demand Prediction Model](./004.md)
- [ADR-007 – Data Platform Architecture](./007.md)
- [ADR-011 – Immutable Audit Log Architecture](./011.md)
- [ADR-013 – Observability & Metrics Standardisation](./013.md)
- [ADR-014 – AI Interchange Layer Architecture](./014.md)
- [ADR-016 – AI Data Pipeline & Feature Store Design](./016.md)
- [ADR-017 – AI Governance & Explainability Framework](./017.md)
- [ADR-018 – AI Cost & Budget Guardrails](./018.md)
- [ADR-019 – Policy-as-Data Framework](./019.md)

---

[Back to ADR Index](../README.md)