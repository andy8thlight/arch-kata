---
id: "0014"
title: AI Interchange Layer Architecture
status: proposed
date: 2025-10-22
---

## Context and Problem Statement

MobilityCorp is introducing multiple AI capabilities across domains: **forecasting**, **routing assistant**, **anomaly detection**, **concierge personalisation**, and more.  
Today, individual services call models directly, leading to **duplicated integrations**, **inconsistent cost tracking**, and **fragmented consent and explainability controls**.

We need a **central AI Interchange Layer** that:
- Exposes a unified API for AI tasks and models.  
- Manages **provider selection**, **cost tracking**, **rate limits**, and **quotas**.  
- Enforces **consent checks** and **PII policies** before inference.  
- Captures **prompts, inputs metadata, and outputs** for **explainability** and **audit** (see ADR-011).  
- Integrates with the **Data Platform** (ADR-007), **Observability** (ADR-013), and **Subscription/Entitlements** (ADR-012).

---

## Questions

- Central bus vs library: should the Interchange be a **network service** or a **shared SDK**?  
- How do we route requests across multiple model providers (cost, latency, capability)?  
- What data is persisted for explainability vs excluded for privacy and cost?  
- How do we enforce **consent** and **subscription tier** at the AI edge?  
- Where do embeddings and **optional Vector DB** retrieval (ADR-009) plug in?

---

## Options

### Option A — Per-Service Direct Integration
Each microservice integrates with AI providers independently (SDK or HTTP).

**Pros**
- Simple to start; no central dependency.

**Cons**
- Duplicated logic for auth, retries, cost tracking, consent.  
- Inconsistent observability and explainability.  
- Hard to switch models or providers globally.

---

### Option B — Shared Client Library Only
Provide a standard SDK that wraps AI provider calls with logging and cost headers.

**Pros**
- Faster adoption; minimal infra.  
- Some consistency for telemetry and cost tags.

**Cons**
- Still fragmented policies and routing.  
- Requires coordinated upgrades across all services.  
- Limited runtime governance and throttling.

---

### Option C — Central AI Interchange Service (Recommended)
Introduce a **network service** that becomes the **single entry point** for AI tasks.  
It standardises **task schemas**, **policy enforcement**, **provider routing**, **cost tracking**, and **explainability logging**.  
A thin SDK forwards requests to the Interchange.

**Pros**
- Consistent governance (consent, PII, entitlements).  
- Centralised **cost**, **rate limiting**, and **routing** across providers.  
- Uniform **observability** and **audit** with replay capability.  
- Pluggable **RAG** via optional Vector DB (ADR-009).  

**Cons**
- New runtime dependency and scaling surface.  
- Requires careful SLOs to avoid becoming a bottleneck.

---

## Recommendation

Adopt **Option C – Central AI Interchange Service** that fronts all AI inference and retrieval.

**Key decisions**
1. **Unified Task API**: standard request envelope (`task_type`, `inputs_ref`, `consent_ref`, `tier`, `trace_id`).  
2. **Policy Gate**: enforce **consent**, **redaction**, **subscription tier** (ADR-012) before calling models.  
3. **Provider Router**: route by **capability**, **cost**, **latency**, **fallbacks**; support A/B and canary.  
4. **Cost & Usage Metering**: per-call token and time accounting; export to billing analytics (ADR-007) and dashboards.  
5. **Explainability Journal**: store minimal prompt metadata, model, version, decision rationale; hash-chain into **Audit Log** (ADR-011).  
6. **Optional Retrieval**: integrate **Vector DB** for RAG-style context (ADR-009).  
7. **Observability**: OpenTelemetry spans with unified labels (ADR-013); per-task SLOs.

---

## Consequences

**Positive**
- One place to manage **costs, consent, and controls** for all AI usage.  
- Faster provider swaps and experiments without app changes.  
- Uniform observability, auditability, and explainability.

**Trade-offs**
- Interchange adds a network hop and must meet strict SLOs.  
- Requires migration effort from direct integrations.  
- Needs strong versioning for task schemas and model policies.

---

## Implementation Details (High-level)

| Component | Responsibility | Notes |
|---|---|---|
| **AI Interchange API** | Single entry for AI tasks; validates policy and routes | Exposes REST and async endpoints |
| **Policy & Consent Gate** | Check consent, PII, subscription tier | Integrates with ADR-012 and privacy registry |
| **Provider Router** | Select model provider based on rules and health | Supports canary, A/B, cost caps |
| **RAG Connector (optional)** | Query Vector DB for context retrieval | See ADR-009; cached embeddings |
| **Cost Meter & Ledger** | Record tokens, time, provider charges | Exports to ADR-007; logs to ADR-011 |
| **Explainability Journal** | Minimal prompt/output metadata for replay | Hash-linked to ADR-011 for tamper-evidence |
| **OTel/Observability** | Traces, metrics, error budgets | ADR-013 SLOs and dashboards |
| **Client SDK** | Thin wrapper used by services | Enforces schema and correlation IDs |

**Sequence Example**

---

## Risks and Mitigations

| Risk                             | Likelihood | Impact | Mitigation                                                 |
| -------------------------------- | ---------: | -----: | ---------------------------------------------------------- |
| Interchange becomes a bottleneck |        Med |   High | Horizontal scale, per-tenant rate limits, circuit breakers |
| Provider outage or drift         |        Med |   High | Multi-provider routing, health checks, fallbacks           |
| Sensitive data leakage           |        Low |   High | Redaction policies, data minimisation, consent enforcement |
| Cost overruns                    |        Med |    Med | Per-team budgets, quotas, cost alerts, hard caps           |
| Explainability storage bloat     |        Med |    Med | Minimal journaling with TTL, sampled payloads              |
| Schema/version sprawl            |        Med |    Med | Versioned task contracts, SDK validation in CI             |
| Privacy non-compliance           |        Low |   High | Pseudonymisation, EU residency, DPIAs, audit hooks         |

---

## Alternatives Considered

* Per-service direct integration — rejected for governance and cost visibility gaps.
* SDK-only wrapper — rejected for limited runtime policy enforcement and routing.
* Central Interchange with thin SDK — chosen for unified control, cost management, and explainability.

## Links

* ADR-007 – Data Platform Architecture
* ADR-009 – Personalisation / Concierge Service Architecture
* ADR-011 – Immutable Audit Log Architecture
* ADR-012 – Premium Subscription Model Integration
* ADR-013 – Observability & Metrics Standardisation
* ADR-005 – Routing Solver (VRP-TW)
* ADR-006 – Alerts & Theft Detection Logic
* ADR-010 – Routing & Hub-Slot Reservation Integration
