---
id: "0014"
title: AI Interchange Layer Architecture
status: proposed
date: 2025-10-22
---

## Context and Problem Statement

MobilityCorp runs multiple AI capabilities across European regions: **Demand Prediction (ADR-004)**, **Routing Solver (ADR-005)**, and **Concierge (ADR-009)**.  
Direct, per-service integrations with model hosts lead to **duplicated logic**, **inconsistent consent and cost controls**, and **fragmented observability**.

We require a **central AI Interchange Layer** that:
- Exposes a **unified API** for AI tasks (predict, route_assist, personalise).  
- Enforces **consent**, **policy**, and **subscription tier** at the AI edge.  
- Retrieves **region-aware features** (weather, transport) from the Feature Store (ADR-016).  
- Handles **provider routing** and **cost governance** (ADR-018).  
- Captures **explainability metadata** and logs to **Audit Log (ADR-011)**.  

---

## Questions

- Network service vs shared SDK — where should governance and routing live?  
- How to route by **region, capability, latency, cost**, and **AB tests**?  
- What minimal data to persist for **explainability** while meeting GDPR?  
- How to integrate **Feature Store** for live inference context?  
- How to keep **costs predictable** and **SLOs** reliable?

---

## Options

### Option A — Per-Service Direct Integration
Each microservice calls models and handles its own consent/cost/telemetry.

**Pros**
- Simple for one team to start.
**Cons**
- Duplicated effort; weak governance and inconsistent metrics.

---

### Option B — Shared Client Library Only
A common SDK adds headers, logging, and retries.

**Pros**
- Faster adoption than a new service.
**Cons**
- Still fragmented policy enforcement; limited runtime routing and quotas.

---

### Option C — Central AI Interchange Service (Recommended)
A **network service** is the single entry for AI tasks, with a thin SDK.  
It applies **policy and consent checks**, performs **feature retrieval**, routes to **model endpoints**, captures **cost and explainability**, and returns results.

**Pros**
- Uniform governance, routing, and cost control.  
- Pluggable providers; rapid model swaps and canaries.  
- One place for observability and audit.
**Cons**
- Adds a runtime hop; must meet strict SLOs.

---

## Recommendation

Adopt **Option C – Central AI Interchange Service** with region-aware routing and feature retrieval.

**Key decisions**
1. **Unified Task API**  
   Standard envelope: `task_type`, `region_code`, `inputs_ref`, `user_tier`, `trace_id`.
2. **Policy & Consent Gate**  
   Check consent, PII redaction, and tier (ADR-012, ADR-019) before inference.
3. **Feature Retrieval**  
   Pull live **weather/transport/demand** features from **Feature Store (ADR-016)** when required.
4. **Provider Router**  
   Route to **SageMaker EU endpoints** (ADR-015) or external providers using rules for capability, latency, and cost; support canary and AB.
5. **Cost Governance**  
   Emit per-call usage to **AI Cost Guardrails (ADR-018)** with budgets by team, model, and region.
6. **Explainability Journal**  
   Store minimal metadata and rationale; hash-link to **Audit Log (ADR-011)**; expose summaries via **ADR-017**.
7. **Observability**  
   OTel traces, histograms, and error codes per task; SLOs via ADR-013.

---

## Consequences

**Positive**
- Consistent consent, cost, and explainability controls across all AI usage.  
- Faster provider swaps and safer experiments.  
- Predictable spend with budget enforcement.

**Trade-offs**
- Interchange must scale horizontally and avoid becoming a bottleneck.  
- Requires migration from direct integrations to the unified API.

---

## Implementation Details (High-level)

| Component | Responsibility | Notes |
|---|---|---|
| **Interchange API** | Single entrypoint for AI tasks | REST + async; thin SDK for callers |
| **Policy & Consent Gate** | Validate consent, PII, user tier | Integrates IdP, ADR-012, ADR-019 |
| **Feature Connector** | Fetch region-aware features | Reads from Feature Store (ADR-016) |
| **Provider Router** | Select endpoint by rules and health | Supports canary, AB, fallbacks |
| **Cost Meter** | Record tokens, latency, cost | Publishes to ADR-018, DWH |
| **Explainability Journal** | Persist minimal metadata | Linked to ADR-011, surfaced via ADR-017 |
| **Observability Agent** | OTel traces/metrics/logs | Dashboards via ADR-013 |
| **Model Hosting** | Serve models in EU | SageMaker endpoints (ADR-015) |

**Sequence Example**

---

## Risks and Mitigations

| Risk                           | Likelihood | Impact | Mitigation                                       |
| ------------------------------ | ---------: | -----: | ------------------------------------------------ |
| Interchange becomes bottleneck |        Med |   High | Horizontal scale, autoscaling, circuit breakers  |
| Provider outage or drift       |        Med |   High | Multi-provider routing, health checks, fallbacks |
| Sensitive data leakage         |        Low |   High | Redaction, consent checks, data minimisation     |
| Cost overruns                  |        Med |    Med | Budgets and quotas via ADR-018                   |
| Schema or task-version sprawl  |        Med |    Med | Versioned contracts, SDK validation in CI        |
| Region misrouting              |        Low |    Med | Strict `region_code` validation and tests        |

---

## Alternatives Considered

* Per-service direct model calls — rejected for governance and cost visibility gaps.
* SDK-only wrapper — rejected for limited runtime enforcement and routing.
* Central Interchange — chosen for unified control and regional feature integration.

## Links

* ADR-004 – Demand Prediction Model
* ADR-005 – Routing Solver (VRP-TW)
* ADR-007 – Data Platform Architecture
* ADR-009 – Concierge / Personalisation Service Architecture
* ADR-011 – Immutable Audit Log Architecture
* ADR-012 – Premium Subscription Model Integration
* ADR-013 – Observability & Metrics Standardisation
* ADR-015 – Model Hosting & Inference Strategy
* ADR-016 – AI Data Pipeline & Feature Store Design
* ADR-017 – AI Governance & Explainability Framework
* ADR-018 – AI Cost & Budget Guardrails
* ADR-019 – Policy-as-Data Framework
