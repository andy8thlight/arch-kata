---
id: "0006"
title: Alerts & Theft Detection Logic
status: proposed
date: 2025-10-21
---

## Context and Problem Statement

MobilityCorp must detect and respond to **vehicle theft, unauthorised use, and operational anomalies** in near real time.  
This capability is essential for fleet protection, insurance compliance, and customer trust.

The system must:

- Ingest live telemetry and status updates from vehicles and field devices.  
- Detect suspicious behaviour (e.g., ignition without authorisation, location mismatch, route deviation).  
- Trigger alerts and automated containment actions (lockdown, disable ignition, notify authorities).  
- Maintain **auditability** and **traceability** for all alerts and responses.  
- Integrate with the event-driven data platform (ADR-007) for unified ingestion, storage, and analytics.

The challenge is to balance **detection sensitivity, false positives, and latency**, while maintaining GDPR compliance and operational resilience.

---

## Questions

- Should anomaly detection be fully rule-based, fully AI-driven, or hybrid?  
- How close to real time should detection operate (edge vs central)?  
- How do we manage false positives without desensitising operators?  
- Should historical alert patterns inform future detection logic (vector retrieval)?  
- What mechanisms ensure reliable alert delivery to downstream systems?

---

## Options

### Option A — Rule-Based Engine Only
Define static rules (e.g., “movement outside assigned zone”, “ignition without key”) evaluated on incoming telemetry.

**Pros**
- Simple, deterministic, auditable.  
- Easy to reason about and certify.

**Cons**
- Brittle; requires frequent tuning.  
- Cannot generalise to unseen anomaly types.  

---

### Option B — ML-Driven Anomaly Detection
Train ML models to detect deviations in multi-dimensional telemetry streams.

**Pros**
- Adapts to new and subtle anomalies.  
- Scalable across fleet and geographies.

**Cons**
- Requires labelled historical data.  
- Less transparent; harder to explain results.  
- Higher compute cost and maintenance overhead.  

---

### Option C — Hybrid Approach (Recommended)
Combine deterministic rules with ML anomaly detection, orchestrated via the shared event-driven data platform.  
Augment with **optional Vector DB retrieval** to provide context (“find similar historical events”) for operators and automated triage.

**Pros**
- Fast deterministic response with adaptive intelligence.  
- Explainability through contextual examples.  
- Naturally fits into Kafka → Databricks → AI pipeline.  

**Cons**
- Slightly higher engineering complexity.  
- Requires embedding and retrieval pipeline if Vector DB is activated.  

---

## Recommendation

Adopt **Option C – Hybrid Rule + ML Detection**, leveraging shared infrastructure components:

- **Kafka Event Bus** – Vehicle telemetry and operational events.  
- **Databricks Lakehouse** – Aggregated features, training datasets, historical anomalies.  
- **Feature Store** – Normalisation and model input features.  
- **Anomaly Detection Service** – Combines rule evaluation with ML inference.  
- **Vector Database (optional)** – Semantic retrieval of similar past alerts for context and operator insight.  
- **Alert Orchestrator** – Routes verified alerts to the Operations Portal, Notification Service, and Audit Log.

---

## Consequences

**Positive**
- Real-time theft and anomaly detection across fleet.  
- Explainable, auditable decisions.  
- Extensible for future AI models and retrieval-based explainability.  

**Trade-offs**
- Slightly more operational complexity than rule-only system.  
- Requires additional monitoring of model performance and drift.  
- Optional vector layer introduces governance overhead if activated.  

---

## Implementation Details (High-level)

| Component | Responsibility | Notes |
|---|---|---|
| **Kafka / Event Bus** | Ingest real-time telemetry and status data | Shared ingestion layer (ADR-007) |
| **Databricks Lakehouse** | Aggregate and store historical events | Used for ML training and retrospective analysis |
| **Feature Store** | Curate and normalise features for ML inference | Shared with other AI services |
| **Anomaly Detection Service** | Run rules and ML models; generate alerts | Rule engine + model ensemble |
| **Vector Database (optional)** | Retrieve semantically similar historical alerts | Provides operator context and explainability |
| **Alert Orchestrator** | Deduplicate, prioritise, and route alerts | Publishes verified alerts to downstream systems |
| **Audit Log** | Record detection decisions, triggers, and actions | Immutable; supports post-incident review |
| **Notification Service** | Notify operators, authorities, or automated systems | Configurable escalation paths |

## Sequence Example 

<img width="5210" height="1600" alt="006" src="https://github.com/user-attachments/assets/c0bd78d8-2b32-412d-821d-2e4794c5b937" />

---

## Risks and Mitigations

| Risk                                   | Likelihood | Impact | Mitigation                                                     |
| -------------------------------------- | ---------: | -----: | -------------------------------------------------------------- |
| False positives causing alert fatigue  |        Med |   High | Threshold tuning, contextual filtering, operator feedback loop |
| Missed anomalies (false negatives)     |        Med |   High | Model retraining, ensemble rules                               |
| Latency under heavy telemetry load     |        Med |    Med | Stream partitioning, horizontal scaling                        |
| GDPR exposure from raw telemetry       |        Low |   High | Pseudonymise and aggregate before storage                      |
| Misclassification of legitimate events |        Low |    Med | Manual review queue and audit trail                            |
| Cost of optional vector retrieval      |        Low |    Low | Activate only for explainability use cases                     |


---

## Alternatives Considered

* Pure rule-based detection – simple but too brittle for real-world variability.
* ML-only detection – powerful but opaque and harder to govern.
* Hybrid approach with contextual retrieval – chosen for balanced performance, transparency, and extensibility.

## Links

* ADR-002 – External Dependency SLA & Retry Handling
* ADR-005 – Routing Solver (VRP-TW)
* ADR-007 – Data Platform Architecture
* ADR-008 – Mobile Offline Sync Strategy
* ADR-009 – Personalisation / Concierge Service Architecture
* ADR-013 – Immutable Audit Log Architecture
* ADR-016 – AI Interchange Layer
