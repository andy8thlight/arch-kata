---
id: "0004"
title: Demand Prediction Model
status: proposed
date: 2025-10-22
---

## Context and Problem Statement

MobilityCorp must anticipate **where and when** customers will want to pick up or return vehicles, batteries, or equipment.  
Accurate demand forecasting improves **asset distribution**, **fleet utilisation**, and **customer satisfaction**.

Previous prototypes used static historical averages, offering no response to real-time context such as **weather**, **transport strikes**, or **regional events**.  
With operations spanning multiple European countries, MobilityCorp requires a **context-aware, region-specific prediction model** that can learn and adapt continuously.

---

## Questions

- How can we combine real-time contextual signals (weather, strikes, congestion) with historical usage trends?  
- How do we handle regional variability in demand patterns?  
- Should models be global with regional features, or one per region?  
- How are predictions served to routing and concierge systems in real time?  
- How can we audit and explain predictions under GDPR Art. 22?

---

## Options

### Option A — Static Statistical Model
Simple regression or moving averages using historical pickups.

**Pros**
- Easy to implement and interpret.  
**Cons**
- Ignores dynamic context; low accuracy in volatile conditions.  

---

### Option B — Centralised ML Model (Single Global)
Single ML model trained on all regions with `region_code` as feature.

**Pros**
- Single model to maintain; shared learnings.  
**Cons**
- May miss regional nuances (e.g., differing transport habits, climate).  

---

### Option C — Regional Context-Aware Models (Recommended)
Train and host **region-specific models** that consume shared features (telemetry, transport, weather, events) from the **Feature Store (ADR-016)**.  

**Pros**
- Local accuracy; context-responsive.  
- Supports live updates and retraining per region.  
- Easily integrated with downstream routing and concierge flows.  
**Cons**
- Requires governance and monitoring of multiple models.  

---

## Recommendation

Adopt **Option C – Regional Context-Aware Models** with shared weather and transport-based feature pipeline.

**Key design decisions**
1. **Feature Inputs:** from ADR-016 (Feature Store)  
   - Telemetry: pickup/dropoff counts, trip durations, dwell times  
   - Weather: temperature, precipitation, wind  
   - Transport: service delay scores, strike flags  
   - Temporal: hour, day, season, holidays  
   - Region: `region_code`, hub density, population index  
2. **Model Architecture:** Gradient-boosted trees or neural sequence model per region.  
3. **Training Cadence:** daily retrain with sliding window; retrigger on anomaly or concept drift.  
4. **Serving Pattern:**  
   - Batch forecasts → Databricks → Kafka topic `demand.predictions`  
   - On-demand inference → AI Interchange (ADR-014)  
5. **Integration Targets:**  
   - Routing Solver (ADR-005) for hub prioritisation  
   - Concierge Service (ADR-009) for user recommendations  
6. **Governance:**  
   - Versioning via Model Registry (ADR-015)  
   - Audit via ADR-011  
   - Cost tracking via ADR-018  

---

## Consequences

**Positive**
- Proactive resource allocation and customer balancing.  
- Better SLA adherence under variable conditions.  
- Shared data foundation and governance with other AI models.  

**Trade-offs**
- Requires multi-region training and monitoring.  
- Needs ongoing feature-store alignment and drift control.

---

## Implementation Details (High-level)

| Component | Responsibility | Notes |
|---|---|---|
| **Feature Store (ADR-016)** | Provide unified demand features | Real-time and batch |
| **Training Pipeline (Databricks)** | Train per-region models | Uses weather + transport features |
| **Model Registry (ADR-015)** | Store model versions and metadata | EU-region SageMaker registry |
| **Inference Service (AI Interchange, ADR-014)** | Serve live predictions via REST | Region-aware |
| **Kafka Event Bus** | Broadcast batch forecasts | Topic: `demand.predictions` |
| **Routing Solver (ADR-005)** | Consume forecasts for rebalancing | Demand-weighted routing |
| **Concierge Service (ADR-009)** | Personalised recommendations | Demand + user-context fusion |
| **Audit Log (ADR-011)** | Record model inputs, outputs, hashes | Tamper-evident ledger |
| **Observability (ADR-013)** | Monitor model latency and drift | Unified OTel metrics |

**Sequence Example**

<img width="4662" height="1362" alt="004" src="https://github.com/user-attachments/assets/0a980756-8905-4b25-9880-975c7c3ec221" />

---

## Risks and Mitigations

| Risk                               | Likelihood | Impact | Mitigation                                                     |
| ---------------------------------- | ---------: | -----: | -------------------------------------------------------------- |
| Weather or transport feed outages  |        Low |    Med | Cache and interpolate missing data                             |
| Regional drift or bias             |        Med |   High | Per-region retraining and bias checks                          |
| Model version confusion            |        Low |   High | Registry with explicit version tags                            |
| Cost growth from frequent retrains |        Med |    Med | Budget alerts via ADR-018                                      |
| GDPR explainability gaps           |        Med |   High | Store input features and rationale in ADR-017 governance layer |

---

## Alternatives Considered

* Global model – rejected for lack of regional sensitivity.
* Static historical averages – rejected for poor adaptability.
* Regional contextual models – chosen for accuracy and governance alignment.

## Links

* ADR-005 – Routing Solver (VRP-TW)
* ADR-007 – Data Platform Architecture
* ADR-009 – Concierge / Personalisation Service Architecture
* ADR-011 – Immutable Audit Log Architecture
* ADR-013 – Observability & Metrics Standardisation
* ADR-014 – AI Interchange Layer Architecture
* ADR-015 – Model Hosting & Inference Strategy
* ADR-016 – AI Data Pipeline & Feature Store Design
* ADR-017 – AI Governance & Explainability Framework
* ADR-018 – AI Cost & Budget Guardrails